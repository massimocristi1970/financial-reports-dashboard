<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Reports Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* --- same CSS as before, unchanged --- */
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1><i class="fas fa-chart-line"></i> Financial Reports</h1>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Dashboard</div>
          <div class="nav-link active" onclick="showPage(event, 'overview')">
            <i class="fas fa-tachometer-alt"></i> Overview
          </div>
          <div class="nav-link" onclick="showPage(event, 'data-management')">
            <i class="fas fa-upload"></i> Data Management
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Reports</div>
          <div class="nav-link" onclick="showPage(event, 'lending-volume')">
            <i class="fas fa-coins"></i> Lending Volume
            <span class="data-count" id="lending-volume-count">0</span>
          </div>
          <div class="nav-link" onclick="showPage(event, 'arrears')">
            <i class="fas fa-exclamation-triangle"></i> Arrears Analysis
            <span class="data-count" id="arrears-count">0</span>
          </div>
          <div class="nav-link" onclick="showPage(event, 'liquidations')">
            <i class="fas fa-sync"></i> Liquidations
            <span class="data-count" id="liquidations-count">0</span>
          </div>
          <div class="nav-link" onclick="showPage(event, 'call-center')">
            <i class="fas fa-phone"></i> Call Center
            <span class="data-count" id="call-center-count">0</span>
          </div>
          <div class="nav-link" onclick="showPage(event, 'complaints')">
            <i class="fas fa-clipboard-list"></i> Complaints
            <span class="data-count" id="complaints-count">0</span>
          </div>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <!-- Overview -->
      <div id="overview-page">
        <div class="welcome-section">
          <h2>Welcome to Financial Reports Dashboard</h2>
          <p>Your comprehensive financial reporting and analytics platform</p>
        </div>
        <div class="chart-card">
          <h3>Getting Started</h3>
          <p>Click "Data Management" to upload your CSV files, then view your reports using the sidebar navigation.</p>
        </div>
      </div>

      <!-- Data Management -->
      <div id="data-management-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Data Management</h1>
          <p class="page-subtitle">Upload and manage CSV data for all report types</p>
        </div>
        <div class="upload-section">
          <div class="upload-grid">
            <div class="upload-card" id="lending-volume-card">
              <i class="fas fa-coins fa-3x" style="color: var(--primary-color);"></i>
              <h3>Lending Volume</h3>
              <p>Track loan origination volumes and customer activity trends</p>
              <input type="file" accept=".csv" style="display: none;" id="lending-volume-file"
                     onchange="uploadFile(this, 'lending-volume')">
              <button class="btn btn-primary" onclick="document.getElementById('lending-volume-file').click()">
                <i class="fas fa-upload"></i> Upload CSV
              </button>
              <div id="lending-volume-status"></div>
            </div>

            <div class="upload-card" id="arrears-card">
              <i class="fas fa-exclamation-triangle fa-3x" style="color: var(--warning-color);"></i>
              <h3>Arrears Analysis</h3>
              <p>Monitor overdue accounts and payment behavior patterns</p>
              <input type="file" accept=".csv" style="display: none;" id="arrears-file"
                     onchange="uploadFile(this, 'arrears')">
              <button class="btn btn-primary" onclick="document.getElementById('arrears-file').click()">
                <i class="fas fa-upload"></i> Upload CSV
              </button>
              <div id="arrears-status"></div>
            </div>

            <div class="upload-card" id="liquidations-card">
              <i class="fas fa-sync fa-3x" style="color: var(--info-color);"></i>
              <h3>Liquidations</h3>
              <p>Track liquidation activities and recovery rate performance</p>
              <input type="file" accept=".csv" style="display: none;" id="liquidations-file"
                     onchange="uploadFile(this, 'liquidations')">
              <button class="btn btn-primary" onclick="document.getElementById('liquidations-file').click()">
                <i class="fas fa-upload"></i> Upload CSV
              </button>
              <div id="liquidations-status"></div>
            </div>

            <div class="upload-card" id="call-center-card">
              <i class="fas fa-phone fa-3x" style="color: var(--success-color);"></i>
              <h3>Call Center Performance</h3>
              <p>Monitor call center metrics and service level analytics</p>
              <input type="file" accept=".csv" style="display: none;" id="call-center-file"
                     onchange="uploadFile(this, 'call-center')">
              <button class="btn btn-primary" onclick="document.getElementById('call-center-file').click()">
                <i class="fas fa-upload"></i> Upload CSV
              </button>
              <div id="call-center-status"></div>
            </div>

            <div class="upload-card" id="complaints-card">
              <i class="fas fa-clipboard-list fa-3x" style="color: var(--danger-color);"></i>
              <h3>Customer Complaints</h3>
              <p>Track customer complaints and resolution performance metrics</p>
              <input type="file" accept=".csv" style="display: none;" id="complaints-file"
                     onchange="uploadFile(this, 'complaints')">
              <button class="btn btn-primary" onclick="document.getElementById('complaints-file').click()">
                <i class="fas fa-upload"></i> Upload CSV
              </button>
              <div id="complaints-status"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Report Pages -->
      <div id="lending-volume-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Lending Volume Analysis</h1>
          <p class="page-subtitle">Track loan origination volumes and customer activity</p>
        </div>
        <div id="lending-content"></div>
      </div>

      <div id="arrears-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Arrears Analysis</h1>
          <p class="page-subtitle">Monitor overdue accounts and payment behavior</p>
        </div>
        <div id="arrears-content"></div>
      </div>

      <div id="liquidations-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Liquidations Analysis</h1>
          <p class="page-subtitle">Track liquidation activities and recovery rates</p>
        </div>
        <div id="liquidations-content"></div>
      </div>

      <div id="call-center-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Call Center Performance</h1>
          <p class="page-subtitle">Monitor call center metrics and service levels</p>
        </div>
        <div id="call-center-content"></div>
      </div>

      <div id="complaints-page" class="hidden">
        <div class="page-header">
          <h1 class="page-title">Customer Complaints</h1>
          <p class="page-subtitle">Track customer complaints and resolution performance</p>
        </div>
        <div id="complaints-content"></div>
      </div>
    </main>
  </div>

  <script>
    // Data storage
    let reportData = {
      'lending-volume': [],
      'arrears': [],
      'liquidations': [],
      'call-center': [],
      'complaints': []
    };

    // Show page
    function showPage(event, pageId) {
      const pages = document.querySelectorAll('[id$="-page"]');
      pages.forEach(p => p.classList.add('hidden'));

      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

      const targetPage = document.getElementById(pageId + '-page');
      if (targetPage) targetPage.classList.remove('hidden');

      event.currentTarget.classList.add('active');

      if (pageId !== 'overview' && pageId !== 'data-management') {
        renderReport(pageId);
      }
    }

    // Upload CSV
    function uploadFile(fileInput, reportType) {
      const file = fileInput.files[0];
      if (!file) return;

      const statusId = reportType + '-status';
      const cardId = reportType + '-card';
      const countId = reportType + '-count';

      const statusElement = document.getElementById(statusId);
      const uploadCard = document.getElementById(cardId);
      const countElement = document.getElementById(countId);

      statusElement.innerHTML = '<div class="status status-info">Processing CSV file...</div>';
      uploadCard.classList.add('loading');

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const csvText = e.target.result;
          const data = parseCSV(csvText);
          reportData[reportType] = data;

          statusElement.innerHTML = '<div class="status status-success">Loaded ' + data.length + ' records</div>';
          uploadCard.classList.add('has-data');
          uploadCard.classList.remove('loading');

          if (countElement) {
            countElement.textContent = data.length;
            countElement.classList.add('has-data');
          }
        } catch (err) {
          statusElement.innerHTML = '<div class="status status-error">Error: ' + err.message + '</div>';
          uploadCard.classList.remove('loading');
        }
      };
      reader.readAsText(file);
    }

    // Parse CSV
    function parseCSV(csvText) {
      const lines = csvText.split('\n').filter(l => l.trim());
      if (!lines.length) throw new Error('Empty CSV');

      const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
        const record = {};
        headers.forEach((h, idx) => {
          let val = values[idx] || '';
          if (val.includes('£')) {
            val = val.replace(/[£,]/g, '');
            if (!isNaN(parseFloat(val))) val = parseFloat(val);
          } else if (!isNaN(parseFloat(val))) {
            val = parseFloat(val);
          }
          record[h] = val;
        });
        if (Object.values(record).some(v => v !== '')) data.push(record);
      }
      return data;
    }

    // Render report
    function renderReport(reportType) {
      let contentId = reportType === 'lending-volume'
        ? 'lending-content'
        : reportType === 'call-center'
        ? 'call-center-content'
        : reportType + '-content';

      const contentElement = document.getElementById(contentId);
      const data = reportData[reportType];

      if (!data || !data.length) {
        contentElement.innerHTML =
          '<div class="chart-card">' +
          '<h3>No Data Available</h3>' +
          '<p>Upload a CSV file to view analytics.</p>' +
          '<button class="btn btn-primary" onclick="showPage(event, \'data-management\')">Upload Data</button>' +
          '</div>';
        return;
      }

      const headers = Object.keys(data[0]).slice(0, 8);
      const displayData = data.slice(0, 100);

      let html = '<div class="data-table">';
      html += '<div class="table-header"><h3>Data Records (' + data.length + ' total)</h3></div>';
      html += '<div class="table-container"><table><thead><tr>';

      headers.forEach(h => {
        const label = h.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        html += '<th>' + label + '</th>';
      });
      html += '</tr></thead><tbody>';

      displayData.forEach(r => {
        html += '<tr>';
        headers.forEach(h => {
          let val = r[h];
          if (typeof val === 'number' && (h.toLowerCase().includes('amount') || h.toLowerCase().includes('payment'))) {
            val = '<span class="currency">£' + val.toLocaleString() + '</span>';
          }
          html += '<td>' + (val || '-') + '</td>';
        });
        html += '</tr>';
      });

      html += '</tbody></table></div>';
      html += '<div style="padding:15px;color:#64748b;">Showing ' + displayData.length + ' of ' + data.length + ' records</div>';
      html += '</div>';

      contentElement.innerHTML = html;
    }
  </script>
</body>
</html>
