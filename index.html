<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Financial Reports Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin:0; background:#f8fafc; color:#0f172a; }
    .app-container { display:flex; min-height:100vh; }
    .sidebar { width:260px; background:#fff; border-right:1px solid #e2e8f0; }
    .sidebar-header { padding:18px 20px; font-weight:700; border-bottom:1px solid #e2e8f0; }
    .nav-link { cursor:pointer; padding:12px 18px; display:flex; gap:10px; align-items:center; color:#334155; }
    .nav-link:hover { background:#f1f5f9; }
    .nav-link.active { background:#eef6ff; border-left:3px solid #3b82f6; color:#1d4ed8; }
    .main-content { flex:1; padding:24px; }
    .page-header { margin-bottom:16px; }
    .page-title { font-size:24px; font-weight:800; }
    .hidden { display:none; }
    .panel { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:18px; margin-bottom:18px; }
    .filters { display:flex; gap:16px; row-gap:10px; flex-wrap:wrap; align-items:flex-end; }
    .filters label { font-size:12px; font-weight:700; color:#475569; display:block; margin-bottom:6px; }
    .filters select { min-width:140px; padding:8px; border-radius:8px; border:1px solid #cbd5e1; background:#fff; }
    .filters select[multiple]{ min-width:200px; height:112px; }
    .kpi-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:14px; }
    .kpi { background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:14px 16px; }
    .kpi .label { font-size:12px; color:#64748b; }
    .kpi .value { font-size:22px; font-weight:800; margin-top:6px; }
    .charts-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:16px; }
    .chart-card h3 { margin:0 0 8px 0; font-size:14px; color:#334155; }
    .data-table table { width:100%; border-collapse: collapse; }
    th, td { padding:10px 12px; border-bottom:1px solid #e5e7eb; text-align:left; white-space:nowrap; }
    th { background:#f8fafc; position:sticky; top:0; z-index:1; }
    .table-wrap { max-height:420px; overflow:auto; border:1px solid #e5e7eb; border-radius:12px; }
    .small { color:#64748b; font-size:12px; }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header"><i class="fas fa-chart-line"></i> Financial Reports</div>
      <nav>
        <div class="nav-link active" onclick="showPage(event,'overview')"><i class="fas fa-home"></i> Overview</div>
        <div class="nav-link" onclick="showPage(event,'lending-volume')"><i class="fas fa-coins"></i> Lending Volume</div>
        <div class="nav-link" onclick="showPage(event,'arrears')"><i class="fas fa-exclamation-triangle"></i> Arrears</div>
        <div class="nav-link" onclick="showPage(event,'liquidations')"><i class="fas fa-sync"></i> Liquidations</div>
        <div class="nav-link" onclick="showPage(event,'complaints')"><i class="fas fa-clipboard-list"></i> Complaints</div>
        <div class="nav-link" onclick="showPage(event,'financial-crime')"><i class="fas fa-user-shield"></i> Financial Crime</div>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="main-content">
      <section id="overview-page">
        <div class="page-header"><div class="page-title">Welcome</div></div>
        <div class="panel small">Reports auto-load from <code>/shared-data</code> in this repo.</div>
      </section>

      <section id="lending-volume-page" class="hidden"><div class="page-header"><div class="page-title">Lending Volume</div></div><div id="lending-volume-filters" class="panel"></div><div id="lending-volume-content"></div></section>
      <section id="arrears-page" class="hidden"><div class="page-header"><div class="page-title">Arrears</div></div><div id="arrears-filters" class="panel"></div><div id="arrears-content"></div></section>
      <section id="liquidations-page" class="hidden"><div class="page-header"><div class="page-title">Liquidations</div></div><div id="liquidations-filters" class="panel"></div><div id="liquidations-content"></div></section>
      <section id="complaints-page" class="hidden"><div class="page-header"><div class="page-title">Complaints</div></div><div id="complaints-filters" class="panel"></div><div id="complaints-content"></div></section>
      <section id="financial-crime-page" class="hidden"><div class="page-header"><div class="page-title">Financial Crime</div></div><div id="financial-crime-filters" class="panel"></div><div id="financial-crime-content"></div></section>
    </main>
  </div>

  <script>
const reportData = { 'lending-volume':[], 'arrears':[], 'liquidations':[], 'complaints':[], 'financial-crime':[] };
const lastUpdated = {};
const charts = {};

// [helpers, parser, configs, filters, rendering functions remain as in your last working version]

// ---------- Load Shared Data ----------
async function loadSharedData() {
  const files = {
    'lending-volume': 'shared-data/lending_volume.csv',
    'arrears': 'shared-data/lending_volume.csv',
    'liquidations': 'shared-data/lending_volume.csv',
    'complaints': 'shared-data/complaints.csv',
    'financial-crime': 'shared-data/financial_crime.csv'
  };

  for (const [key, path] of Object.entries(files)) {
    try {
      const res = await fetch(path);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      reportData[key] = parseCSV(text);
      lastUpdated[key] = new Date().toLocaleString();
      console.log(`Loaded ${reportData[key].length} records for ${key} from ${path}`);
    } catch (err) {
      console.error(`Error loading ${path}:`, err);
    }
  }

  // âœ… Build filters + render all reports after data load
  Object.keys(reportConfigs).forEach(type => {
    buildFiltersUI(type);
    renderReport(type);
  });

  // Default to overview
  showPage(null, 'overview');
}

document.addEventListener('DOMContentLoaded', loadSharedData);
</script>
</body>
</html>
